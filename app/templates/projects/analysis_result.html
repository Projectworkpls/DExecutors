{% extends "base.html" %}

{% block title %}AI Analysis Results - {{ project.title }}{% endblock %}

{% block content %}
<div class="analysis-wrapper">
    <!-- Hero Section with Status -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <div class="status-indicator" aria-label="Project status">
                    {% if analysis.recommendation == 'approve' %}
                        <div class="status-badge success">
                            <span class="status-icon" aria-label="Approved">‚úÖ</span>
                            <span class="status-text">Project Approved</span>
                        </div>
                    {% elif analysis.recommendation == 'reject' %}
                        <div class="status-badge danger">
                            <span class="status-icon" aria-label="Rejected">‚ùå</span>
                            <span class="status-text">Project Rejected</span>
                        </div>
                    {% else %}
                        <div class="status-badge warning">
                            <span class="status-icon" aria-label="Needs Modifications">‚ö†Ô∏è</span>
                            <span class="status-text">Needs Modifications</span>
                        </div>
                    {% endif %}
                </div>

                <h1 class="project-title">{{ project.title }}</h1>
                <p class="project-subtitle">AI Feasibility Analysis Complete</p>

                <div class="score-display">
                    <div class="score-circle" data-score="{{ analysis.feasibility_score }}">
                        <div class="score-inner">
                            <span class="score-number">{{ analysis.feasibility_score or 0 }}</span>
                            <span class="score-unit">%</span>
                        </div>
                        <span class="score-label">Feasibility Score</span>
                        <progress value="{{ analysis.feasibility_score or 0 }}" max="100" style="width: 100%;"></progress>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-info">
                        <h3>{{ analysis.get('ideal_grades', 'N/A') }}</h3>
                        <p>Ideal Grades</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-info">
                        <h3>{{ analysis.get('total_hours_needed', 0) }}h</h3>
                        <p>Total Time</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-info">
                        <h3>{{ analysis.get('total_days_required', 0) }} days</h3>
                        <p>Timeline</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="stat-info">
                        <h3>{{ analysis.get('supervision_level', 'Moderate')|title }}</h3>
                        <p>Supervision</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="content-section">
        <div class="container">
            <!-- AI Message -->
            <div class="message-card" aria-label="AI Analysis Summary">
                <div class="message-header">
                    <h2>üìù AI Analysis Summary</h2>
                    <div class="confidence-badge">
                        <span>AI Confidence: {{ analysis.get('confidence_level', 85) }}%</span>
                    </div>
                </div>
                <div class="message-body">
                    <p>{{ analysis.get('parent_message', 'Analysis completed successfully.') }}</p>
                </div>
            </div>

            <!-- Two Column Layout -->
            <div class="analysis-grid">
                <!-- Left Column -->
                <div class="analysis-left">
                    <!-- Age Suitability -->
                    <div class="analysis-card">
                        <h3>üë∂ Age Group Analysis</h3>
                        <div class="age-assessment">
                            <div class="age-item">
                                <span class="label">Selected Grades:</span>
                                <span class="value">{{ project.get('target_grades', '5-9') }}</span>
                                {% if analysis.get('selected_grades_suitable') %}
                                    <span class="badge success">‚úÖ Suitable</span>
                                {% else %}
                                    <span class="badge warning">‚ö†Ô∏è Consider Changes</span>
                                {% endif %}
                            </div>
                            <div class="age-item">
                                <span class="label">Ideal Age Range:</span>
                                <span class="value">{{ analysis.get('ideal_age_range', 'N/A') }}</span>
                            </div>
                            <div class="age-item">
                                <span class="label">Recommended Grades:</span>
                                <span class="value">{{ analysis.get('ideal_grades', 'N/A') }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Time Breakdown -->
                    <div class="analysis-card">
                        <h3>‚è∞ Time Analysis</h3>
                        <div class="time-grid">
                            <div class="time-item">
                                <span class="time-value">{{ analysis.get('daily_work_hours', 0) }}h</span>
                                <span class="time-label">Daily Hours</span>
                            </div>
                            <div class="time-item">
                                <span class="time-value">{{ analysis.get('total_days_required', 0) }}</span>
                                <span class="time-label">Total Days</span>
                            </div>
                            <div class="time-item">
                                <span class="time-value {% if analysis.get('is_deadline_realistic') %}success{% else %}danger{% endif %}">
                                    {% if analysis.get('is_deadline_realistic') %}‚úÖ{% else %}‚ùå{% endif %}
                                </span>
                                <span class="time-label">Deadline OK</span>
                            </div>
                        </div>
                    </div>

                    <!-- Strengths & Concerns -->
                    <div class="feedback-cards">
                        <div class="feedback-card strengths">
                            <h4>üí™ Strengths</h4>
                            <ul>
                                {% for strength in analysis.get('strengths', []) %}
                                <li>{{ strength }}</li>
                                {% else %}
                                <li>No major strengths identified.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="feedback-card concerns">
                            <h4>‚ö†Ô∏è Concerns</h4>
                            <ul>
                                {% for concern in analysis.get('realistic_concerns', analysis.get('concerns', [])) %}
                                <li>{{ concern }}</li>
                                {% else %}
                                <li>No major concerns identified.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="analysis-right">
                    <!-- Milestones -->
                    {% if analysis.get('suggested_milestones') or analysis.get('simplified_milestones') %}
                    <div class="analysis-card">
                        <h3>üéØ Project Milestones</h3>
                        <div class="milestones-list">
                            {% for milestone in analysis.get('simplified_milestones', analysis.get('suggested_milestones', [])) %}
                            <div class="milestone-item">
                                <div class="milestone-number">{{ loop.index }}</div>
                                <div class="milestone-content">
                                    <h5>{{ milestone.get('title', milestone.get('name', 'Milestone ' ~ loop.index)) }}</h5>
                                    <p>{{ milestone.get('description', 'No description provided') }}</p>
                                    {% if milestone.get('estimated_hours') %}
                                    <span class="milestone-time">‚è±Ô∏è {{ milestone.estimated_hours }}h</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% else %}
                            <p>No milestones suggested.</p>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Budget Analysis -->
                    {% if analysis.get('budget_breakdown') or analysis.get('realistic_budget_breakdown') %}
                    <div class="analysis-card">
                        <h3>üí∞ Budget Breakdown</h3>
                        <div class="budget-summary">
                            <div class="budget-total">
                                <span class="budget-amount">‚Çπ{{ project.budget }}</span>
                                <span class="budget-label">Total Budget</span>
                            </div>
                            <div class="budget-status">
                                {{ analysis.get('budget_assessment', analysis.get('budget_reality_check', 'Reasonable')) }}
                            </div>
                        </div>
                        <div class="budget-items">
                            {% for item, cost in (analysis.get('realistic_budget_breakdown', {}) or analysis.get('budget_breakdown', {})).items() %}
                            <div class="budget-item">
                                <span class="item-name">{{ item|title }}</span>
                                <span class="item-cost">‚Çπ{{ cost }}</span>
                            </div>
                            {% else %}
                            <div class="budget-item">
                                <span class="item-name">No breakdown available.</span>
                                <span class="item-cost"></span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Recommendations -->
                    {% if analysis.get('simplification_needed') or analysis.get('modifications') %}
                    <div class="analysis-card">
                        <h3>üí° Recommendations</h3>
                        {% if analysis.get('simplification_needed') %}
                        <div class="recommendation-section">
                            <h5>Simplifications Needed:</h5>
                            <ul>
                                {% for item in analysis.simplification_needed %}
                                <li>{{ item }}</li>
                                {% else %}
                                <li>No simplifications suggested.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if analysis.get('modifications') %}
                        <div class="recommendation-section">
                            <h5>Suggested Modifications:</h5>
                            <ul>
                                {% for item in analysis.modifications %}
                                <li>{{ item }}</li>
                                {% else %}
                                <li>No modifications suggested.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                {% if analysis.get('recommendation') == 'approve' %}
                <button class="btn btn-primary btn-large" onclick="publishProject()">
                    üöÄ Publish Project
                </button>
                {% elif analysis.get('recommendation') == 'reject' %}
                <button class="btn btn-danger btn-large" onclick="editProject()">
                    üìù Revise Project
                </button>
                {% else %}
                <button class="btn btn-warning btn-large" onclick="editProject()">
                    ‚úèÔ∏è Make Modifications
                </button>
                {% endif %}

                <button class="btn btn-outline" onclick="window.history.back()">
                    ‚Üê Back to Edit
                </button>
            </div>
        </div>
    </section>
</div>

<script>
function publishProject() {
    if (confirm('Publish this project for students to apply?')) {
        window.location.href = '/projects/{{ project.id }}/publish';
    }
}
function editProject() {
    window.location.href = '/projects/{{ project.id }}/edit';
}
</script>
{% endblock %}
